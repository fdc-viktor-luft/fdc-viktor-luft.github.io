import{E as H,F as k,b as B}from"./FooterRestart.3507ed4b.js";import{F as D}from"./FooterUndo.aa08db4b.js";import{c as R,P as b,U as S,r as p,a as c,j as s,_ as W,b as u,F as _}from"./index.7eb625f0.js";import{a as g,P as J,C as E}from"./ClickableDescription.73d519e6.js";import{M as h}from"./event-util.b0b3c4c9.js";import{F as x}from"./input.c36591f6.js";import{a as M}from"./Cube.4cd62949.js";var l=(t=>(t.M1="M1",t.M2="M2",t.M3="M3",t.M4="M4",t.M5="M5",t.M6="M6",t.TRIPLE="TRIPLE",t.FOURSOME="FOURSOME",t.FULL_HOUSE="FULL_HOUSE",t.SMALL_STREET="SMALL_STREET",t.BIG_STREET="BIG_STREET",t.SENSATION="SENSATION",t.CHANCE="CHANCE",t))(l||{});const L={M1:{multiplier:1},M2:{multiplier:2},M3:{multiplier:3},M4:{multiplier:4},M5:{multiplier:5},M6:{multiplier:6},TRIPLE:{},FOURSOME:{},FULL_HOUSE:{fixedValue:25},SMALL_STREET:{fixedValue:30},BIG_STREET:{fixedValue:40},SENSATION:{fixedValue:50},CHANCE:{}},A={players:[]},O="gimmick",v=()=>{try{const t=b.get(O);return JSON.parse(t)}catch{return[]}},$=()=>v()[0]||A,[N,f]=R($()),P=t=>{f.set(t);const e=f.get(),n=v();n.unshift(e),n.length>20&&n.pop(),b.set(O,JSON.stringify(n))},q=()=>{P(A)},z=()=>{const t=v();if(t.length>1){t.shift(),b.set(O,JSON.stringify(t));const e=t[0];f.set(e)}},Q=t=>({...t,points:{}}),X=t=>{const e=g.get().players.slice(0,t).map(Q);P({players:e})},V=t=>{const e=Math.min(...t.map(({points:n})=>Object.keys(n).length));return t.find(({points:n})=>Object.keys(n).length===e)},Y=t=>P(({players:e})=>{const n=[...e],r=n.findIndex(({uuid:a})=>a===t.uuid);return n[r]=t,{players:n}}),Z=(t,e)=>{const{multiplier:n}=L[e],r=n?n*t:t,a=V(f.get().players);a.points[e]=r,Y(a)},U=(t,e)=>e.every(n=>t[n]!==void 0),w=t=>U(t,Object.values(l).slice(0,6)),tt=t=>U(t,Object.values(l)),et=t=>t.every(e=>tt(e.points)),G=t=>S.sum(t.M1,t.M2,t.M3,t.M4,t.M5,t.M6)>=63?35:0,K=({points:t})=>S.sum(...Object.values(t))+G(t),st=t=>{var r;const e=t.map(a=>({player:a,sum:K(a)})),n=Math.max(...e.map(({sum:a})=>a));return(r=e.find(({sum:a})=>a===n))==null?void 0:r.player},o={restart:q,undo:z,selectPlayers:X,selectValue:Z,getCurrentActivePlayer:V,calculateSum:K,calculateBonus:G,finishedMultiplier:w,allFinished:et,playerWithMostPoints:st},nt={numberOfPlayers:{onChange:t=>{const e=Number(t);if(isNaN(e)||e<1||e>10)return{id:"players.count.invalid",values:{min:1,max:10}};if(e>g.get().players.length)return{id:"players.count.exceedsRegistered"}}}},at=({numberOfPlayers:t})=>{o.selectPlayers(+t)},rt={numberOfPlayers:""},it=()=>{const[t,e]=p.exports.useState(h.initialData(rt)),{fields:n,Form:r}=h.useForm();return c("div",{className:"spade-is-trump",children:[s("div",{className:"configs",children:c(r,{className:"startup",onSubmit:at,validation:nt,data:t,onChange:e,children:[s(x,{field:n.numberOfPlayers,label:"players.count",type:"number"}),s("button",{type:"submit",children:W("APP.start")})]})}),s(J,{})]})},lt={num:{onSubmit:t=>{const e=Number(t);if(isNaN(e)||e<5||e>30)return{id:"GIMMICK.value.invalid",values:{min:5,max:30}}}}},ct={num:""},C=({value:t,gimmickRow:e,close:n})=>{const[r,a]=p.exports.useState(h.initialData(ct)),{fields:d,Form:y}=h.useForm(),m=p.exports.useCallback(()=>{o.selectValue(t,e),n()},[t,e,n]),i=p.exports.useCallback(({num:I})=>{o.selectValue(+I,e),n()},[e,n]);return s("div",{className:S.classNames("value",t===-1&&"no-hover"),onClick:t===-1?void 0:m,children:t===-1?s(y,{onSubmit:i,validation:lt,data:r,onChange:a,children:s(x,{field:d.num,type:"number",autoFocus:!0})}):t===0?"\u2718":t>10?"\u2713":t})},ot=({gimmickRow:t,close:e})=>{const{multiplier:n,fixedValue:r}=L[t];return c("div",{className:"select-overlay",children:[s("div",{className:"select-overlay-inner",children:n?[0,1,2,3,4,5].map(a=>s(C,{gimmickRow:t,value:a,close:e},a)):r?[0,r].map(a=>s(C,{gimmickRow:t,value:a,close:e},a)):[0,-1].map(a=>s(C,{gimmickRow:t,value:a,close:e},a))}),s("div",{className:"select-overlay-outer",onClick:e})]})},ut={[l.M1]:s(M,{count:1}),[l.M2]:s(M,{count:2}),[l.M3]:s(M,{count:3}),[l.M4]:s(M,{count:4}),[l.M5]:s(M,{count:5}),[l.M6]:s(M,{count:6}),[l.TRIPLE]:u("GIMMICK.triple"),[l.FOURSOME]:u("GIMMICK.foursome"),[l.FULL_HOUSE]:u("GIMMICK.fullHouse"),[l.SMALL_STREET]:u("GIMMICK.smallStreet"),[l.BIG_STREET]:u("GIMMICK.bigStreet"),[l.SENSATION]:u("GIMMICK.sensation"),[l.CHANCE]:u("GIMMICK.chance")},T=({row:t,players:e,activePlayer:n,onClick:r})=>c("tr",{children:[s("td",{className:"first",children:ut[t]}),e.map(({points:a,uuid:d})=>s("td",{className:S.classNames(n.uuid===d||"inactive"),onClick:a[t]===void 0&&n.uuid===d?()=>r(t):void 0,children:a[t]===0?"\u2718":a[t]},d))]}),dt=()=>{const[t,e]=p.exports.useState(),n=p.exports.useCallback(()=>e(void 0),[]),r=N(({players:i})=>i),a=o.getCurrentActivePlayer(r),d=Object.values(l).slice(0,6),y=Object.values(l).slice(6),m=N(({players:i})=>o.allFinished(i)?o.playerWithMostPoints(i):void 0);return c(_,{children:[c("table",{children:[s("thead",{children:c("tr",{children:[s("th",{className:"first"}),r.map(({name:i,shortcut:I,uuid:F},j)=>s(E,{desc:i,short:s("span",{children:I}),tag:"th",className:S.classNames(!m&&a.uuid===F&&"active",(m==null?void 0:m.uuid)===F&&"winner")},j))]})}),c("tbody",{children:[d.map(i=>s(T,{row:i,players:r,onClick:e,activePlayer:a},i)),c("tr",{children:[s(E,{desc:u("GIMMICK.bonus"),short:"\u{1F381}",tag:"td"}),r.map(i=>s("td",{children:o.finishedMultiplier(i.points)?o.calculateBonus(i.points)||"\u2718":""},i.uuid))]}),y.map(i=>s(T,{row:i,players:r,onClick:e,activePlayer:a},i)),c("tr",{children:[s(E,{desc:u("GIMMICK.sum"),short:"\u2211",tag:"td"}),r.map(i=>s("td",{children:o.calculateSum(i)},i.uuid))]})]})]}),t&&s(ot,{gimmickRow:t,close:n})]})},mt=({started:t})=>c(k,{children:[s(D,{onClick:o.undo}),t&&s(B,{onClick:o.restart})]}),Et=()=>{const t=N(({players:e})=>!!e.length);return s(H,{fix:o.restart,children:c(_,{children:[s("div",{className:"gimmick",children:t?s(dt,{}):s(it,{})}),s(mt,{started:t})]})})};export{Et as default};
