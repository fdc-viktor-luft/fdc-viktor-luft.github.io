import{j as o,U as d,a as r,r as k,G as C,c as Ot,P as j,F as w,_ as P,I as N}from"./index.7eb625f0.js";import{C as ht,a as x}from"./Cube.4cd62949.js";import{F as z,a as A,E as pt,b as Bt}from"./FooterRestart.3507ed4b.js";import{S as Gt}from"./select.b6966feb.js";import{F as tt}from"./FooterUndo.aa08db4b.js";import"./event-util.b0b3c4c9.js";const gt=t=>t.map(e=>e.split("")),Yt=t=>t.split("").map(Number),y=({label:t,grid:e,stars:s,backgroundColor:n})=>({label:t,grid:gt(e),stars:Yt(s),backgroundColor:n}),v={black:{label:"AGAIN.color.black",backgroundColor:"#222222",stars:"251513205150635",grid:["GOBBRRY","GGGROBY","GYRROBB","YGGGORB","YYGOORB","YYGORRB","YOGBBRR","GORBBYY","BRRGOYY","BBRGOOY","BBYYORG","OOYYRBG","YOOORBG","YGGRRBO","YGGBROO"]},blue:{label:"AGAIN.color.blue",backgroundColor:"#64a8ff",stars:"125161046141324",grid:["ROBBGGY","RROBBGY","GROOBYY","GBBORYY","YBGORRR","YGGGRBO","YYGRBBO","GGRRBYO","GGOOBYR","RRGOBYY","RGGOOBY","RYGOBBB","RRGBYOO","OOGBYYR","OOYYGBR"]},green:{label:"AGAIN.color.green",backgroundColor:"#22b244",stars:"044266214405344",grid:["OGBBBRY","GGBORRY","BGOOORY","BGGORRY","RRYOBBG","RYYGOBB","RGGGOBY","GRBBOYY","GGRBBYO","GGRBYYO","YRRBOOG","YYROOBG","YYORRGB","RROOYGB","RYYOOGB"]},orange:{label:"AGAIN.color.orange",backgroundColor:"#d03b09",stars:"030414031051652",grid:["OBYYRGG","OOBYYGR","YOBBGGR","OOGYBRR","RGGYBBO","RRRYGBO","RGGYYBO","GGYBOOR","OYYBBGR","RRYYBGO","GRRYBOO","GGRRBYO","GBBOOYR","GYYOBBR","GYOOBBR"]},pink:{label:"AGAIN.color.pink",backgroundColor:"#9c2271",stars:"206201230315514",grid:["GRBBBOY","GOBBRYY","OOBRRGY","OYRRBGG","OGGRBBY","RGGGBOY","RBBGOOY","RYYOBGG","YYROBBG","BYRROOG","BGRYYOO","BOOGYYR","BOGGYRR","BOOGYRR","RROGBYY"]},violet:{label:"AGAIN.color.violet",backgroundColor:"#701fa7",stars:"530420214213612",grid:["YOOOGBR","YBOGGGR","OBBYGRR","OBBYRGG","ORYYYGB","GRRYOOB","BROOGGY","BROGGYY","BROOYGG","YYBBORG","YYBBORG","RBBOOYG","RRRBOYG","GRBBOYY","GOBRRRY"]},yellow:{label:"AGAIN.color.yellow",backgroundColor:"#d09012",stars:"625062536324220",grid:["RRBOYYG","GGROBYY","GRROBBY","YRBOOGG","YRBBOGG","YYGBROO","YYGBROO","OOGBRYY","RRGGBYO","RRGYBOO","GGRYBBO","GGBBRYO","GBORRYY","BBBROYG","YBRROOG"]}},b={black:y(v.black),blue:y(v.blue),green:y(v.green),orange:y(v.orange),pink:y(v.pink),violet:y(v.violet),yellow:y(v.yellow)},H=Object.keys(b),mt=H.map(t=>({label:b[t].label,value:t})),m=({content:t,color:e,customColor:s,circled:n,crossed:a,onClick:l,star:R,borderColor:c,flicker:p})=>o("div",{children:o("div",{className:d.classNames("box box-bordered",p&&"box-flicker"),onClick:l,children:r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",children:[o("rect",{x:"0",y:"0",width:"50",height:"50",rx:"10",ry:"10",fill:e&&ht[e]||s||"white"}),c&&o("rect",{x:"1",y:"1",width:"48",height:"48",rx:"10",ry:"10",fill:"none",stroke:c,strokeWidth:"3"}),R&&o("polygon",{points:"25 5 32 20 45 20 35 28 42 45 25 35 8 45 15 28 2 20 18 20",fill:"white"}),t!==void 0&&o("text",{textAnchor:"middle",x:"25",y:"35",fontSize:"30",children:t}),n&&o("circle",{cx:"25",cy:"25",r:"23",fill:"none",stroke:"black",strokeWidth:"2"}),a&&r("g",{stroke:"black",strokeWidth:"4",children:[o("line",{x1:"5",y1:"5",x2:"45",y2:"45"}),o("line",{x1:"5",y1:"45",x2:"45",y2:"5"})]})]})})}),kt=t=>()=>i.blockColorPoints(t),E="OBGRY".split(""),yt=({colorPointsBlocked:t,completedColors:e})=>r("div",{className:d.classNames("again-color-points"),children:[o("div",{className:"again-color-points-1",children:E.map((s,n)=>o(m,{content:5,color:s,crossed:t[n],onClick:kt(n),circled:!t[n]&&e[n]},n))}),o("div",{className:"again-color-points-2",children:E.map((s,n)=>o(m,{content:3,color:s,circled:t[n]&&e[n]},n))})]}),vt="533322212223335".split("").map(Number),Ct="322211101112223".split("").map(Number),L=t=>t.map(e=>e.every(s=>s)),T=(t,e)=>"OBGRY".split("").map(s=>t.every((n,a)=>n.every((l,R)=>e.grid[a][R]!==s||l))),wt=(t,e,s,n)=>{const{rowPointsBlocked:a,colorPointsBlocked:l,crossed:R,takenJokers:c}=t,p=d.sum(...s.map((O,G)=>O?a[G]?Ct[G]:vt[G]:0)),u=d.sum(...n.map((O,G)=>O?l[G]?3:5:0)),g=-c,B=d.sum(...R.map((O,G)=>O[e.stars[G]]?2:0));return p+u+g+B},Z=(t,e=!0)=>t.map((s,n)=>s.map((a,l)=>!a&&(e&&n===7||(t[n-1]||{})[l]||(t[n+1]||{})[l]||s[l-1]||s[l+1]))),Nt=(t,e)=>{const s=L(t.crossed),n=T(t.crossed,e),a=wt(t,e,s,n);return{completedRows:s,completedColors:n,totalPoints:a}},ft=(t,e,s,n,a)=>{if(t){const l=L(e),c=L(s).map((B,O)=>B&&!l[O]),p=T(s,n),u=T(e,n),g=p.map((B,O)=>B&&!u[O]).findIndex(Boolean);return{type:Y.CHOSEN,data:{...t,completedRows:c,completedColor:E[g]},index:a+1}}return{type:Y.SKIP,index:a+1}},ot=t=>{const e=t.filter(s=>typeof s.index=="number");return e.length>0?e[e.length-1]:void 0},bt=(t,e,s)=>{const n=k.exports.useRef(e);n.current=e;const a=k.exports.useCallback(l=>{n.current(l)},[]);k.exports.useEffect(()=>(C.window().addEventListener(t,a,s),()=>C.window().removeEventListener(t,a,s)),[t,s])},St=(t,e)=>{let s=0;return(...n)=>{C.window().clearTimeout(s),s=C.window().setTimeout(()=>t(...n),e)}},At={debounced:St},Pt=t=>{const e=k.exports.useRef(t);e.current=t;const s=k.exports.useCallback(At.debounced(()=>{e.current(C.window().innerWidth)},10),[]);bt("resize",s)},xt=.48,W="again-resize",Et=()=>{const t=xt-(window.innerHeight-48)/window.innerWidth;return t>0?t*window.innerWidth:0},Q=()=>{const t=Et(),e=t?`0 ${t}px`:"";Array.from(document.getElementsByClassName(W)).forEach(s=>{s.style.setProperty("padding",e)})},Wt=()=>{k.exports.useEffect(Q,[]),Pt(Q)},K="ABCDEFGHIJKLMNO".split(""),Dt=()=>o("div",{className:d.classNames("again-letters",W),children:K.map((t,e)=>o(m,{content:t},e))});var Y=(t=>(t.ROW="row",t.COLOR="color",t.JOKER="joker",t.SKIP="skip",t.CHOSEN="chosen",t))(Y||{});const Jt=d.array(7).map(()=>!1),f=d.array(15).map(()=>Jt),Ft=d.array(15).map(()=>!1),Ht=d.array(5).map(()=>!1),$={crossed:f,rowPointsBlocked:Ft,colorPointsBlocked:Ht,takenJokers:0,turns:[],option:null},M={crossed:f,turnCrossed:f,chosen:null,completedColor:null},[U,h]=Ot({againSplash:null,again:$,againData:null,againStarted:M}),Lt=t=>h.set({againSplash:t}),I="again",V=()=>{try{const t=j.get(I);return JSON.parse(t)}catch{return[]}},Tt=t=>Math.floor(Math.random()*t),_t=()=>H[Tt(H.length)],jt=t=>t==="random"?_t():t,zt=t=>{const e=jt(t);h.set({againData:b[e]}),q({option:e})},D=t=>h.set(({againStarted:e})=>({againStarted:{...e,...t}})),q=(t,e)=>{h.set(({again:a})=>({again:{...a,...t}}));const s=h.get().again;e||D({crossed:s.crossed});const n=V();n.unshift(s),n.length>20&&n.pop(),j.set(I,JSON.stringify(n))},Kt=()=>{if(!h.get().againSplash){const t=V();if(t.length>1){t.shift(),j.set(I,JSON.stringify(t));const e=t[0];h.set({again:e,againSplash:"undo",againData:e.option?b[e.option]:null}),D({crossed:e.crossed})}}},J=()=>V()[0]||$,$t=()=>{const t=J();h.set({again:t,againData:t.option?b[t.option]:null,againStarted:{...M,crossed:t.crossed}})},Mt=()=>{q($),D(M),h.set({againData:null})};$t();const Ut=(t,e)=>{const{againStarted:{crossed:s,turnCrossed:n,chosen:a},againData:l}=h.get(),R=s[e];if(!R[t]&&l){const c=l.grid[e][t];if(a&&(c!==a.color||a.count>4))return;const p=d.nextArray(R,t,!0),u=d.nextArray(n[e],t,!0),g=a?a.count+1:1;i.setStarted({crossed:d.nextArray(s,e,p),turnCrossed:d.nextArray(n,e,u),chosen:{color:c,count:g}})}},It=()=>{const{againStarted:{crossed:t,chosen:e},againSplash:s,again:n,againData:a}=h.get();if(!s&&a){const l=ot(n.turns),R=l?l.index:0,c=ft(e,n.crossed,t,a,R);i.set({crossed:t,turns:[...n.turns,c]}),i.setSplash(c.type==="skip"?"skip":"submit"),i.setStarted({turnCrossed:f,chosen:null,completedColor:c.type==="chosen"?c.data.completedColor:void 0})}},Vt=()=>{const{againSplash:t,again:e}=h.get();t||(i.setSplash("cancel"),i.setStarted({turnCrossed:f,chosen:null,crossed:e.crossed,completedColor:null}))},qt=()=>i.setStarted({completedColor:null}),Zt=()=>{const{takenJokers:t,turns:e}=J();i.set({takenJokers:t+1,turns:[...e,{type:"joker"}]},!0)},Qt=t=>{const{rowPointsBlocked:e,turns:s}=J();i.set({rowPointsBlocked:d.nextArray(e,t,!0),turns:[...s,{type:"row",data:K[t]}]},!0)},Xt=t=>{const{colorPointsBlocked:e,turns:s}=J();i.set({colorPointsBlocked:d.nextArray(e,t,!0),turns:[...s,{type:"color",data:E[t]}]},!0)},i={set:q,undo:Kt,restart:Mt,chooseData:zt,setSplash:Lt,setStarted:D,onCross:Ut,onFinish:It,onAbort:Vt,onClosePopup:qt,takeJoker:Zt,blockRowPoints:Qt,blockColorPoints:Xt},S=({children:t,onClick:e})=>o("div",{children:o("div",{className:"box",onClick:e,children:t})}),to=()=>o(S,{children:r("svg",{viewBox:"0 0 50 50",children:[o("rect",{x:"0",y:"0",width:"50",height:"50",rx:"10",ry:"10",fill:"black"}),o("text",{textAnchor:"middle",x:"25",y:"38",fontSize:"40",fontWeight:"900",fill:"white",children:"?"})]})}),oo=()=>o(S,{children:r("svg",{viewBox:"0 0 50 50",children:[o("rect",{x:"0",y:"0",width:"50",height:"50",rx:"10",ry:"10",fill:"black"}),r("g",{stroke:"white",strokeWidth:"10",children:[o("line",{x1:"10",y1:"10",x2:"40",y2:"40"}),o("line",{x1:"10",y1:"40",x2:"40",y2:"10"})]})]})}),eo=()=>o(S,{children:o("svg",{viewBox:"0 0 50 50",children:o("line",{x1:"15",y1:"45",x2:"35",y2:"5",stroke:"black",strokeWidth:"10"})})}),so=()=>o(S,{children:r("svg",{viewBox:"0 0 50 50",children:[o("line",{x1:"10",y1:"20",x2:"40",y2:"20",stroke:"black",strokeWidth:"7"}),o("line",{x1:"10",y1:"30",x2:"40",y2:"30",stroke:"black",strokeWidth:"7"})]})}),et=({taken:t,onClick:e})=>o(S,{onClick:e,children:r("svg",{viewBox:"0 0 50 50",children:[o("circle",{cx:"25",cy:"25",r:"23",fill:"white",stroke:"black",strokeWidth:"2"}),o("text",{textAnchor:"middle",x:"25",y:"38",fontSize:"40",fontWeight:"900",children:"!"}),t&&r("g",{stroke:"black",strokeWidth:"4",children:[o("line",{x1:"7",y1:"7",x2:"43",y2:"43"}),o("line",{x1:"7",y1:"43",x2:"43",y2:"7"})]})]})}),no=({takenJokers:t})=>r("div",{className:"again-jokers",children:[o(to,{}),o(eo,{}),o(oo,{}),o(so,{}),d.array(8).map((e,s)=>o(et,{onClick:s===t?i.takeJoker:void 0,taken:s<t},s))]}),ao="533322212223335".split("").map(Number),ro="322211101112223".split("").map(Number),co=t=>()=>i.blockRowPoints(t),_=(t,e)=>Boolean(e&&e.type===Y.CHOSEN&&e.data.completedRows&&e.data.completedRows[t]),X="#5eee61",lo=({rowPointsBlocked:t,completedRows:e,lastTurn:s})=>r("div",{className:d.classNames("again-row-points",W),children:[o("div",{className:"again-row-points-1",children:ao.map((n,a)=>o(m,{content:n,crossed:t[a],onClick:t[a]?void 0:co(a),circled:!t[a]&&e[a],customColor:!t[a]&&_(a,s)?X:void 0},a))}),o("div",{className:"again-row-points-2",children:ro.map((n,a)=>o(m,{content:n,circled:t[a]&&e[a],customColor:t[a]&&_(a,s)?X:void 0},a))})]}),io=({gridData:t,crossed:e,clickable:s,lastTurn:n,onCross:a})=>{const l=k.exports.useCallback((R,c)=>()=>a(R,c),[a]);return o("div",{className:d.classNames("again-grid",W),children:t.grid.map((R,c)=>o("div",{className:d.classNames("again-row",_(c,n)&&"row-alert"),children:R.map((p,u)=>{const g=t.stars[c],B=e[c],O=c===7,G=s[c][u];return o(m,{onClick:G?l(u,c):void 0,color:p,star:g===u,crossed:B[u],borderColor:O?"white":"black"},u)})},c))})},st=()=>o("svg",{className:"icon",viewBox:"0 0 500 500",children:r("g",{stroke:"red",strokeWidth:"100",children:[o("line",{x1:"80",y1:"80",x2:"420",y2:"420"}),o("line",{x1:"80",y1:"420",x2:"420",y2:"80"})]})}),nt=()=>o("svg",{className:"icon",viewBox:"0 0 500 500",children:r("g",{stroke:"darkgreen",strokeWidth:"100",children:[o("line",{x1:"70",y1:"180",x2:"262",y2:"347"}),o("line",{x1:"220",y1:"320",x2:"420",y2:"80"})]})}),Ro=()=>o(w,{children:o(N.Ban,{className:"cube"})}),at=({chosen:{count:t,color:e}})=>r(w,{children:[o(x,{count:t}),o(x,{color:e})]}),uo=({chosen:t})=>r(z,{hideHome:!0,className:"turn-control top",children:[o(A,{onClick:i.onAbort,children:o(st,{})}),o(A,{className:"turn",children:o(at,{chosen:t})}),o(A,{onClick:i.onFinish,children:o(nt,{})})]}),Oo=({chosen:{completedColor:t,completedRows:e}})=>{const s=[];return t&&s.push(o(x,{color:t},"color")),e&&e.forEach((n,a)=>{n&&s.push(o(m,{content:K[a]},a))}),s.length>0?r(w,{children:[o(N.ArrowRight,{className:"success-arrow"}),s]}):null},rt=({turn:t,hideIndex:e})=>{switch(t.type){case Y.CHOSEN:return r("div",{className:"again-turn",children:[e||`${t.index}) `,o("div",{className:"turn-chosen",children:o(at,{chosen:t.data})}),e||o("div",{className:"turn-success",children:o(Oo,{chosen:t.data})})]});case Y.SKIP:return r("div",{className:"again-turn",children:[e||`${t.index}) `,o("div",{className:"turn-chosen",children:o(Ro,{})})]});case Y.JOKER:return o("div",{className:"again-pseudo-turn",children:o(et,{taken:!0})});case Y.COLOR:return o("div",{className:"again-pseudo-turn",children:o(m,{color:t.data,crossed:!0})});case Y.ROW:return o("div",{className:"again-pseudo-turn",children:o(m,{content:t.data,crossed:!0})})}},ho=({turns:t})=>r("div",{className:"again-turns",children:[o("h4",{children:P("AGAIN.madeTurns")}),t.map((e,s)=>o(rt,{turn:e},s))]}),po=({totalPoints:t,lastTurn:e})=>r("div",{className:"again-total",children:[P("AGAIN.points"),o("div",{className:"again-total-points",children:t}),e&&r("div",{className:"again-last-turn",children:[P("AGAIN.lastTurn"),o(rt,{hideIndex:!0,turn:e})]})]}),Bo=({color:t,onClose:e})=>r("div",{className:"again-popup",onClick:e,children:[o("div",{className:"popup-overlay"}),r("div",{className:"popup-content",children:[P("AGAIN.color.finished"),o(x,{color:t})]})]}),Go=t=>{if(!t)return null;switch(t){case"cancel":return o(st,{});case"submit":return o(nt,{});case"undo":return o(N.Undo,{className:"reflect"});case"skip":return o(N.Ban,{});default:return null}},go=()=>i.setSplash(null),Yo=()=>{const{icon:t}=U(({againSplash:s})=>({icon:s}));k.exports.useEffect(()=>()=>{window.setTimeout(go,500)},[t]);const e=Go(t);return e?r("div",{className:"again-splash",children:[o("div",{className:"splash-overlay"}),o("div",{className:"splash-content",children:e})]}):null},mo=({gridData:t})=>{Wt();const{again:e,againSplash:s,againStarted:n}=U(({again:dt,againSplash:Rt,againStarted:ut})=>({again:dt,againSplash:Rt,againStarted:ut})),{crossed:a,chosen:l,turnCrossed:R,completedColor:c}=n,{rowPointsBlocked:p,colorPointsBlocked:u,takenJokers:g,turns:B}=e,{completedRows:O,completedColors:G,totalPoints:ct}=Nt(e,t),{backgroundColor:lt}=t,it=l?Z(R,!1):Z(a),F=ot(B);return r("div",{className:"again",style:{backgroundColor:lt},children:[o(Yo,{}),c&&!s&&o(Bo,{color:c,onClose:i.onClosePopup}),r("div",{className:"again-inner",children:[o(io,{gridData:t,crossed:a,clickable:it,onCross:i.onCross,lastTurn:F}),o(Dt,{}),o(lo,{rowPointsBlocked:p,completedRows:O,lastTurn:F}),o(no,{takenJokers:g}),o(yt,{colorPointsBlocked:u,completedColors:G}),o(po,{totalPoints:ct,lastTurn:F}),o(ho,{turns:B})]})]})},ko={label:"AGAIN.color.choose",value:void 0},yo={label:"AGAIN.color.random",value:"random"},vo=t=>t&&i.chooseData(t),Co=[ko,...mt,yo],wo=()=>o("div",{className:"again-selection",children:o(Gt,{options:Co,onChange:vo,value:void 0})}),No=()=>r(z,{className:"top",children:[o(tt,{onClick:i.undo}),o(Bt,{onClick:i.restart}),o(A,{onClick:i.onFinish,description:"APP.skip",children:o(N.Forward,{})})]}),Eo=()=>{const{againData:t,chosen:e}=U(({againData:s,againStarted:{chosen:n}})=>({againData:s,chosen:n}));return t?o(pt,{fix:i.restart,children:r(w,{children:[e?o(uo,{chosen:e}):o(No,{}),o(mo,{gridData:t})]})}):r(w,{children:[o(wo,{}),o(z,{children:o(tt,{onClick:i.undo})})]})};export{Eo as default};
