import{j as s,U as d,a as r,r as y,G as C,c as Rt,P as _,F as v,_ as N,I as f}from"./index.04a4b329.js";import{C as Ot,a as P}from"./Cube.645d40da.js";import{F as z,a as A,E as Gt,b as Bt}from"./FooterRestart.3459ca14.js";import{S as ht}from"./select.9b03eb79.js";import{F as X}from"./FooterUndo.f5ae4039.js";import"./event-util.6fcdd9df.js";const ut=t=>t.map(o=>o.split("")),pt=t=>t.split("").map(Number),Yt=({label:t,grid:o,stars:e,backgroundColor:n})=>({label:t,grid:ut(o),stars:pt(e),backgroundColor:n}),gt={black:{label:"AGAIN.color.black",backgroundColor:"#222222",stars:"251513205150635",grid:["GOBBRRY","GGGROBY","GYRROBB","YGGGORB","YYGOORB","YYGORRB","YOGBBRR","GORBBYY","BRRGOYY","BBRGOOY","BBYYORG","OOYYRBG","YOOORBG","YGGRRBO","YGGBROO"]},blue:{label:"AGAIN.color.blue",backgroundColor:"#64a8ff",stars:"125161046141324",grid:["ROBBGGY","RROBBGY","GROOBYY","GBBORYY","YBGORRR","YGGGRBO","YYGRBBO","GGRRBYO","GGOOBYR","RRGOBYY","RGGOOBY","RYGOBBB","RRGBYOO","OOGBYYR","OOYYGBR"]},green:{label:"AGAIN.color.green",backgroundColor:"#22b244",stars:"044266214405344",grid:["OGBBBRY","GGBORRY","BGOOORY","BGGORRY","RRYOBBG","RYYGOBB","RGGGOBY","GRBBOYY","GGRBBYO","GGRBYYO","YRRBOOG","YYROOBG","YYORRGB","RROOYGB","RYYOOGB"]},orange:{label:"AGAIN.color.orange",backgroundColor:"#d03b09",stars:"030414031051652",grid:["OBYYRGG","OOBYYGR","YOBBGGR","OOGYBRR","RGGYBBO","RRRYGBO","RGGYYBO","GGYBOOR","OYYBBGR","RRYYBGO","GRRYBOO","GGRRBYO","GBBOOYR","GYYOBBR","GYOOBBR"]},pink:{label:"AGAIN.color.pink",backgroundColor:"#9c2271",stars:"206201230315514",grid:["GRBBBOY","GOBBRYY","OOBRRGY","OYRRBGG","OGGRBBY","RGGGBOY","RBBGOOY","RYYOBGG","YYROBBG","BYRROOG","BGRYYOO","BOOGYYR","BOGGYRR","BOOGYRR","RROGBYY"]},violet:{label:"AGAIN.color.violet",backgroundColor:"#701fa7",stars:"530420214213612",grid:["YOOOGBR","YBOGGGR","OBBYGRR","OBBYRGG","ORYYYGB","GRRYOOB","BROOGGY","BROGGYY","BROOYGG","YYBBORG","YYBBORG","RBBOOYG","RRRBOYG","GRBBOYY","GOBRRRY"]},yellow:{label:"AGAIN.color.yellow",backgroundColor:"#d09012",stars:"625062536324220",grid:["RRBOYYG","GGROBYY","GRROBBY","YRBOOGG","YRBBOGG","YYGBROO","YYGBROO","OOGBRYY","RRGGBYO","RRGYBOO","GGRYBBO","GGBBRYO","GBORRYY","BBBROYG","YBRROOG"]},grey:{label:"AGAIN.color.grey",backgroundColor:"#cfcfcf",stars:"630360526100354",grid:["RBBOOGY","RYYBOGG","OYBBRRG","YYBGROO","YOBBGGR","ROOYBGG","RROYBGG","GROBBYY","GBBOYYR","YBGOORR","YYGGORB","OYYGRRB","ORRGYBB","OORRYBG","BOORYGG"]}},w=Object.fromEntries(Object.entries(gt).map(([t,o])=>[t,Yt(o)])),H=Object.keys(w),mt=H.map(t=>({label:w[t].label,value:t})),k=({content:t,color:o,customColor:e,circled:n,crossed:a,onClick:l,star:R,borderColor:c,flicker:B})=>s("div",{children:s("div",{className:d.classNames("box box-bordered",B&&"box-flicker"),onClick:l,children:r("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 50 50",children:[s("rect",{x:"0",y:"0",width:"50",height:"50",rx:"10",ry:"10",fill:o&&Ot[o]||e||"white"}),c&&s("rect",{x:"1",y:"1",width:"48",height:"48",rx:"10",ry:"10",fill:"none",stroke:c,strokeWidth:"3"}),R&&s("polygon",{points:"25 5,31 20,45 20,34 28,40 44,25 34,9 44,16 28,5 20,19 20",fill:"white"}),t!==void 0&&s("text",{textAnchor:"middle",x:"25",y:"35",fontSize:"30",children:t}),n&&s("circle",{cx:"25",cy:"25",r:"23",fill:"none",stroke:"black",strokeWidth:"2"}),a&&r("g",{stroke:"black",strokeWidth:"4",children:[s("line",{x1:"5",y1:"5",x2:"45",y2:"45"}),s("line",{x1:"5",y1:"45",x2:"45",y2:"5"})]})]})})}),kt=t=>()=>i.blockColorPoints(t),x="OBGRY".split(""),yt=({colorPointsBlocked:t,completedColors:o})=>r("div",{className:d.classNames("again-color-points"),children:[s("div",{className:"again-color-points-1",children:x.map((e,n)=>s(k,{content:5,color:e,crossed:t[n],onClick:kt(n),circled:!t[n]&&o[n]},n))}),s("div",{className:"again-color-points-2",children:x.map((e,n)=>s(k,{content:3,color:e,circled:t[n]&&o[n]},n))})]}),Ct="533322212223335".split("").map(Number),vt="322211101112223".split("").map(Number),L=t=>t.map(o=>o.every(e=>e)),j=(t,o)=>"OBGRY".split("").map(e=>t.every((n,a)=>n.every((l,R)=>o.grid[a][R]!==e||l))),Nt=(t,o,e,n)=>{const{rowPointsBlocked:a,colorPointsBlocked:l,crossed:R,takenJokers:c,hasStandardPoints:B}=t,O=d.sum(...e.map((Y,g)=>Y?a[g]?vt[g]:Ct[g]:0)),u=d.sum(...n.map((Y,g)=>Y?l[g]?3:5:0)),h=-c,p=d.sum(...R.map((Y,g)=>Y[o.stars[g]]?2:0));return O+u+h+p+(B?-22:0)},q=(t,o=!0)=>t.map((e,n)=>e.map((a,l)=>!a&&(o&&n===7||(t[n-1]||{})[l]||(t[n+1]||{})[l]||e[l-1]||e[l+1]))),ft=(t,o)=>{const e=L(t.crossed),n=j(t.crossed,o),a=Nt(t,o,e,n);return{completedRows:e,completedColors:n,totalPoints:a}},bt=(t,o,e,n,a)=>{if(t){const l=L(o),c=L(e).map((h,p)=>h&&!l[p]),B=j(e,n),O=j(o,n),u=B.map((h,p)=>h&&!O[p]).findIndex(Boolean);return{type:m.CHOSEN,data:{...t,completedRows:c,completedColor:x[u]},index:a+1}}return{type:m.SKIP,index:a+1}},tt=t=>{const o=t.filter(e=>typeof e.index=="number");return o.length>0?o[o.length-1]:void 0},wt=(t,o,e)=>{const n=y.exports.useRef(o);n.current=o;const a=y.exports.useCallback(l=>{n.current(l)},[]);y.exports.useEffect(()=>(C.window().addEventListener(t,a,e),()=>C.window().removeEventListener(t,a,e)),[t,e])},St=(t,o)=>{let e=0;return(...n)=>{C.window().clearTimeout(e),e=C.window().setTimeout(()=>t(...n),o)}},At={debounced:St},Pt=t=>{const o=y.exports.useRef(t);o.current=t;const e=y.exports.useCallback(At.debounced(()=>{o.current(C.window().innerWidth)},10),[]);wt("resize",e)},xt=.48,E="again-resize",Et=()=>{const t=xt-(window.innerHeight-48)/window.innerWidth;return t>0?t*window.innerWidth:0},Z=()=>{const t=Et(),o=t?`0 ${t}px`:"";Array.from(document.getElementsByClassName(E)).forEach(e=>{e.style.setProperty("padding",o)})},Wt=()=>{y.exports.useEffect(Z,[]),Pt(Z)},K="ABCDEFGHIJKLMNO".split(""),Dt=()=>s("div",{className:d.classNames("again-letters",E),children:K.map((t,o)=>s(k,{content:t},o))});var m=(t=>(t.ROW="row",t.COLOR="color",t.JOKER="joker",t.SKIP="skip",t.CHOSEN="chosen",t))(m||{});const Jt=d.array(7).map(()=>!1),b=d.array(15).map(()=>Jt),Ft=d.array(15).map(()=>!1),Ht=d.array(5).map(()=>!1),M={crossed:b,rowPointsBlocked:Ft,colorPointsBlocked:Ht,takenJokers:0,turns:[],option:null,hasStandardPoints:!1},$={crossed:b,turnCrossed:b,chosen:null,completedColor:null},[W,G]=Rt({againSplash:null,again:M,againData:null,againStarted:$}),Lt=t=>G.set({againSplash:t}),I="again",U=()=>{try{const t=_.get(I);return JSON.parse(t)}catch{return[]}},jt=t=>Math.floor(Math.random()*t),Tt=()=>H[jt(H.length)],_t=t=>t==="random"?Tt():t,zt=t=>{const o=_t(t);G.set({againData:w[o]}),V({option:o})},D=t=>G.set(({againStarted:o})=>({againStarted:{...o,...t}})),V=(t,o)=>{G.set(({again:a})=>({again:{...a,...t}}));const e=G.get().again;o||D({crossed:e.crossed});const n=U();n.unshift(e),n.length>20&&n.pop(),_.set(I,JSON.stringify(n))},Kt=()=>{if(!G.get().againSplash){const t=U();if(t.length>1){t.shift(),_.set(I,JSON.stringify(t));const o=t[0];G.set({again:o,againSplash:"undo",againData:o.option?w[o.option]:null}),D({crossed:o.crossed})}}},J=()=>U()[0]||M,Mt=()=>{const t=J();G.set({again:t,againData:t.option?w[t.option]:null,againStarted:{...$,crossed:t.crossed}})},$t=()=>{V({...M,hasStandardPoints:G.get().again.hasStandardPoints}),D($),G.set({againData:null})};Mt();const It=(t,o)=>{const{againStarted:{crossed:e,turnCrossed:n,chosen:a},againData:l}=G.get(),R=e[o];if(!R[t]&&l){const c=l.grid[o][t];if(a&&(c!==a.color||a.count>4))return;const B=d.nextArray(R,t,!0),O=d.nextArray(n[o],t,!0),u=a?a.count+1:1;i.setStarted({crossed:d.nextArray(e,o,B),turnCrossed:d.nextArray(n,o,O),chosen:{color:c,count:u}})}},Ut=()=>{const{againStarted:{crossed:t,chosen:o},againSplash:e,again:n,againData:a}=G.get();if(!e&&a){const l=tt(n.turns),R=l?l.index:0,c=bt(o,n.crossed,t,a,R);i.set({crossed:t,turns:[...n.turns,c]}),i.setSplash(c.type==="skip"?"skip":"submit"),i.setStarted({turnCrossed:b,chosen:null,completedColor:c.type==="chosen"?c.data.completedColor:void 0})}},Vt=()=>{const{againSplash:t,again:o}=G.get();t||(i.setSplash("cancel"),i.setStarted({turnCrossed:b,chosen:null,crossed:o.crossed,completedColor:null}))},qt=()=>i.setStarted({completedColor:null}),Zt=()=>{const{takenJokers:t,turns:o}=J();i.set({takenJokers:t+1,turns:[...o,{type:"joker"}]},!0)},Qt=t=>{const{rowPointsBlocked:o,turns:e}=J();i.set({rowPointsBlocked:d.nextArray(o,t,!0),turns:[...e,{type:"row",data:K[t]}]},!0)},Xt=t=>{const{colorPointsBlocked:o,turns:e}=J();i.set({colorPointsBlocked:d.nextArray(o,t,!0),turns:[...e,{type:"color",data:x[t]}]},!0)},i={set:V,undo:Kt,restart:$t,chooseData:zt,setSplash:Lt,setStarted:D,onCross:It,onFinish:Ut,onAbort:Vt,onClosePopup:qt,takeJoker:Zt,blockRowPoints:Qt,blockColorPoints:Xt},S=({children:t,onClick:o})=>s("div",{children:s("div",{className:"box",onClick:o,children:t})}),to=()=>s(S,{children:r("svg",{viewBox:"0 0 50 50",children:[s("rect",{x:"0",y:"0",width:"50",height:"50",rx:"10",ry:"10",fill:"black"}),s("text",{textAnchor:"middle",x:"25",y:"38",fontSize:"40",fontWeight:"900",fill:"white",children:"?"})]})}),oo=()=>s(S,{children:r("svg",{viewBox:"0 0 50 50",children:[s("rect",{x:"0",y:"0",width:"50",height:"50",rx:"10",ry:"10",fill:"black"}),r("g",{stroke:"white",strokeWidth:"10",children:[s("line",{x1:"10",y1:"10",x2:"40",y2:"40"}),s("line",{x1:"10",y1:"40",x2:"40",y2:"10"})]})]})}),so=()=>s(S,{children:s("svg",{viewBox:"0 0 50 50",children:s("line",{x1:"15",y1:"45",x2:"35",y2:"5",stroke:"black",strokeWidth:"10"})})}),eo=()=>s(S,{children:r("svg",{viewBox:"0 0 50 50",children:[s("line",{x1:"10",y1:"20",x2:"40",y2:"20",stroke:"black",strokeWidth:"7"}),s("line",{x1:"10",y1:"30",x2:"40",y2:"30",stroke:"black",strokeWidth:"7"})]})}),ot=({taken:t,onClick:o})=>s(S,{onClick:o,children:r("svg",{viewBox:"0 0 50 50",children:[s("circle",{cx:"25",cy:"25",r:"23",fill:"white",stroke:"black",strokeWidth:"2"}),s("text",{textAnchor:"middle",x:"25",y:"38",fontSize:"40",fontWeight:"900",children:"!"}),t&&r("g",{stroke:"black",strokeWidth:"4",children:[s("line",{x1:"7",y1:"7",x2:"43",y2:"43"}),s("line",{x1:"7",y1:"43",x2:"43",y2:"7"})]})]})}),no=({takenJokers:t})=>r("div",{className:"again-jokers",children:[s(to,{}),s(so,{}),s(oo,{}),s(eo,{}),d.array(8).map((o,e)=>s(ot,{onClick:e===t?i.takeJoker:void 0,taken:e<t},e))]}),ao="533322212223335".split("").map(Number),ro="322211101112223".split("").map(Number),co=t=>()=>i.blockRowPoints(t),T=(t,o)=>Boolean(o&&o.type===m.CHOSEN&&o.data.completedRows&&o.data.completedRows[t]),Q="#5eee61",io=({rowPointsBlocked:t,completedRows:o,lastTurn:e})=>r("div",{className:d.classNames("again-row-points",E),children:[s("div",{className:"again-row-points-1",children:ao.map((n,a)=>s(k,{content:n,crossed:t[a],onClick:t[a]?void 0:co(a),circled:!t[a]&&o[a],customColor:!t[a]&&T(a,e)?Q:void 0},a))}),s("div",{className:"again-row-points-2",children:ro.map((n,a)=>s(k,{content:n,circled:t[a]&&o[a],customColor:t[a]&&T(a,e)?Q:void 0},a))})]}),lo=({gridData:t,crossed:o,clickable:e,lastTurn:n,onCross:a})=>{const l=y.exports.useCallback((R,c)=>()=>a(R,c),[a]);return s("div",{className:d.classNames("again-grid",E),children:t.grid.map((R,c)=>s("div",{className:d.classNames("again-row",T(c,n)&&"row-alert"),children:R.map((B,O)=>{const u=t.stars[c],h=o[c],p=c===7,Y=e[c][O];return s(k,{onClick:Y?l(O,c):void 0,color:B,star:u===O,crossed:h[O],borderColor:p?"white":"black"},O)})},c))})},st=()=>s("svg",{className:"icon",viewBox:"0 0 500 500",children:r("g",{stroke:"red",strokeWidth:"100",children:[s("line",{x1:"80",y1:"80",x2:"420",y2:"420"}),s("line",{x1:"80",y1:"420",x2:"420",y2:"80"})]})}),et=()=>s("svg",{className:"icon",viewBox:"0 0 500 500",children:r("g",{stroke:"darkgreen",strokeWidth:"100",children:[s("line",{x1:"70",y1:"180",x2:"262",y2:"347"}),s("line",{x1:"220",y1:"320",x2:"420",y2:"80"})]})}),Ro=()=>s(v,{children:s(f.Ban,{className:"cube"})}),nt=({chosen:{count:t,color:o}})=>r(v,{children:[s(P,{count:t}),s(P,{color:o})]}),Oo=({chosen:t})=>r(z,{hideHome:!0,className:"turn-control top",children:[s(A,{onClick:i.onAbort,children:s(st,{})}),s(A,{className:"turn",children:s(nt,{chosen:t})}),s(A,{onClick:i.onFinish,children:s(et,{})})]}),Go=({chosen:{completedColor:t,completedRows:o}})=>{const e=[];return t&&e.push(s(P,{color:t},"color")),o&&o.forEach((n,a)=>{n&&e.push(s(k,{content:K[a]},a))}),e.length>0?r(v,{children:[s(f.ArrowRight,{className:"success-arrow"}),e]}):null},at=({turn:t,hideIndex:o})=>{switch(t.type){case m.CHOSEN:return r("div",{className:"again-turn",children:[o||`${t.index}) `,s("div",{className:"turn-chosen",children:s(nt,{chosen:t.data})}),o||s("div",{className:"turn-success",children:s(Go,{chosen:t.data})})]});case m.SKIP:return r("div",{className:"again-turn",children:[o||`${t.index}) `,s("div",{className:"turn-chosen",children:s(Ro,{})})]});case m.JOKER:return s("div",{className:"again-pseudo-turn",children:s(ot,{taken:!0})});case m.COLOR:return s("div",{className:"again-pseudo-turn",children:s(k,{color:t.data,crossed:!0})});case m.ROW:return s("div",{className:"again-pseudo-turn",children:s(k,{content:t.data,crossed:!0})})}},Bo=({turns:t})=>r("div",{className:"again-turns",children:[s("h4",{children:N("AGAIN.madeTurns")}),t.map((o,e)=>s(at,{turn:o},e))]}),ho=({totalPoints:t,lastTurn:o})=>r("div",{className:"again-total",children:[N("AGAIN.points"),s("div",{className:"again-total-points",children:t}),o&&r("div",{className:"again-last-turn",children:[N("AGAIN.lastTurn"),s(at,{hideIndex:!0,turn:o})]})]}),uo=({color:t,onClose:o})=>r("div",{className:"again-popup",onClick:o,children:[s("div",{className:"popup-overlay"}),r("div",{className:"popup-content",children:[N("AGAIN.color.finished"),s(P,{color:t})]})]}),po=t=>{if(!t)return null;switch(t){case"cancel":return s(st,{});case"submit":return s(et,{});case"undo":return s(f.Undo,{className:"reflect"});case"skip":return s(f.Ban,{});default:return null}},Yo=()=>i.setSplash(null),go=()=>{const{icon:t}=W(({againSplash:e})=>({icon:e}));y.exports.useEffect(()=>()=>{window.setTimeout(Yo,500)},[t]);const o=po(t);return o?r("div",{className:"again-splash",children:[s("div",{className:"splash-overlay"}),s("div",{className:"splash-content",children:o})]}):null},mo=({gridData:t})=>{Wt();const{again:o,againSplash:e,againStarted:n}=W(({again:it,againSplash:lt,againStarted:dt})=>({again:it,againSplash:lt,againStarted:dt})),{crossed:a,chosen:l,turnCrossed:R,completedColor:c}=n,{rowPointsBlocked:B,colorPointsBlocked:O,takenJokers:u,turns:h}=o,{completedRows:p,completedColors:Y,totalPoints:g}=ft(o,t),{backgroundColor:rt}=t,ct=l?q(R,!1):q(a),F=tt(h);return r("div",{className:"again",style:{backgroundColor:rt},children:[s(go,{}),c&&!e&&s(uo,{color:c,onClose:i.onClosePopup}),r("div",{className:"again-inner",children:[s(lo,{gridData:t,crossed:a,clickable:ct,onCross:i.onCross,lastTurn:F}),s(Dt,{}),s(io,{rowPointsBlocked:B,completedRows:p,lastTurn:F}),s(no,{takenJokers:u}),s(yt,{colorPointsBlocked:O,completedColors:Y}),s(ho,{totalPoints:g,lastTurn:F}),s(Bo,{turns:h})]})]})},ko=({value:t,onChange:o,labelMsg:e})=>r("label",{className:"checkbox",children:[s("input",{type:"checkbox",checked:t,onChange:n=>o(n.target.checked)}),N(e)]}),yo={label:"AGAIN.color.choose",value:void 0},Co={label:"AGAIN.color.random",value:"random"},vo=t=>t&&i.chooseData(t),No=t=>i.set({hasStandardPoints:t}),fo=[yo,...mt,Co],bo=()=>{const t=W(({again:o})=>o.hasStandardPoints);return r("div",{className:"again-selection",children:[s(ht,{options:fo,onChange:vo,value:void 0}),s(ko,{value:t,onChange:No,labelMsg:"AGAIN.activateStandardPoints"})]})},wo=()=>r(z,{className:"top",children:[s(X,{onClick:i.undo}),s(Bt,{onClick:i.restart}),s(A,{onClick:i.onFinish,description:"APP.skip",children:s(f.Forward,{})})]}),Do=()=>{const{againData:t,chosen:o}=W(({againData:e,againStarted:{chosen:n}})=>({againData:e,chosen:n}));return t?s(Gt,{fix:i.restart,children:r(v,{children:[o?s(Oo,{chosen:o}):s(wo,{}),s(mo,{gridData:t})]})}):r(v,{children:[s(bo,{}),s(z,{children:s(X,{onClick:i.undo})})]})};export{Do as default};
