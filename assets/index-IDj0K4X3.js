import{U as l,c as E,P as F,j as e,r as b,I as L,v as y}from"./index-C5d-M75W.js";import{F as R,E as A,b as H}from"./FooterRestart-DWUh72Zz.js";import{F as T}from"./FooterUndo-C2bEwUJe.js";import{S as W}from"./select-DfqDIqjF.js";import"./DisplayError-Bw3wIOAX.js";const j=[2,3,4,5,6,7,8,9,10,11,12],I=[...j].reverse();j.push(-1);I.push(-1);const v=s=>o=>o.map(t=>({color:s,value:t})),f=v("#f84a4a"),h=v("#ffbb00"),g=v("#30b204"),p=v("#416af7"),O=[f(j),h(j),g(I),p(I)],Q=[f([10,6,2,8,3,4,12,5,9,7,11,-1]),h([9,12,4,6,7,2,5,8,11,3,10,-1]),g([8,2,10,12,6,9,7,4,5,11,3,-1]),p([5,7,11,9,12,3,8,10,2,6,4,-1])],k=[[h([2,3,4]),p([5,6,7]),g([8,9,10]),f([11,12,-1])].flat(),[f([2,3]),g([4,5,6,7]),p([8,9]),h([10,11,12,-1])].flat(),[p([12,11,10]),h([9,8,7]),f([6,5,4]),g([3,2,-1])].flat(),[g([12,11]),f([10,9,8,7]),h([6,5]),p([4,3,2,-1])].flat()],D={DEFAULT:{value:O,label:"QUIXX.option.default",withBigPoints:!1},SHUFFLED_NUMBERS:{value:Q,label:"QUIXX.option.shuffledNumbers",withBigPoints:!1},SHUFFLED_COLORS:{value:k,label:"QUIXX.option.shuffledColors",withBigPoints:!1},BIG_POINTS:{value:O,label:"QUIXX.option.bigPoints",withBigPoints:!0},BIG_POINTS_SHUFFLED_NUMBERS:{value:Q,label:"QUIXX.option.bigPoints.shuffledNumbers",withBigPoints:!0},BIG_POINTS_SHUFFLED_COLORS:{value:k,label:"QUIXX.option.bigPoints.shuffledColors",withBigPoints:!0}},X=()=>l.array(12,!1),N={badThrows:0,crossed:l.array(4,null).map(X),crossedBigPoints:l.array(2,null).map(X),closed:l.array(4,!1),option:null},U="quixx",w=()=>{try{const s=F.get(U);return JSON.parse(s)}catch{return[]}},G=()=>w()[0]||N,[B,m]=E(N);m.set(G());const C=s=>{m.set(s);const o=m.get(),t=w();t.unshift(o),t.length>20&&t.pop(),F.set(U,JSON.stringify(t))},J=()=>{C(N)},M=()=>{const s=w();if(s.length>1){s.shift(),F.set(U,JSON.stringify(s));const o=s[0];m.set(o)}},$=()=>C(({badThrows:s})=>({badThrows:s+1})),V=5,z=s=>s*(s+1)/2,P=s=>s.filter(Boolean).length,K=(s,o,t)=>{const r=o.map(P),n=[r[0],r[0],r[1],r[1]],i=t*V;return l.sum(...s.map((a,c)=>z(P(a)+n[c])))-i},S=(s,o)=>C(({crossed:t})=>({crossed:l.nextArray(t,s,l.nextArray(t[s],o,!0))})),Y=(s,o)=>{const{crossed:t,closed:r}=m.get(),n=t[s];n&&!r[s]&&n.lastIndexOf(!0)<o&&(o===n.length-2?P(n)>=5&&(S(s,o),S(s,o+1)):o===n.length-1?C({closed:l.nextArray(r,s,!0)}):S(s,o))},Z=(s,o)=>{const{crossedBigPoints:t}=m.get(),r=t[s];r&&C({crossedBigPoints:l.nextArray(t,s,l.nextArray(r,o,!0))})},ss=s=>C({option:s}),u={restart:J,undo:M,onBadThrow:$,sum:K,onCross:Y,onCrossBigPoints:Z,chooseData:ss},os={label:"QUIXX.option.choose",value:void 0},ts=s=>s&&u.chooseData(s),es=[os,...Object.entries(D).map(([s,{label:o}])=>({value:s,label:o}))],rs=()=>e.jsx("div",{className:"quixx__selection",children:e.jsx(W,{options:es,onChange:ts,value:void 0})}),ns=({firstColor:s,secondColor:o,crossed:t,onClick:r,fieldIdx:n,disabled:i,isLastItem:a})=>{const c=b.useCallback(()=>r(n),[r,n]);return a?e.jsx("div",{}):e.jsx("div",{className:l.classNames("quixx__grid__field quixx__grid__field--big-points",t&&"quixx__grid__field--crossed",i&&!t&&"quixx__grid__field--disabled"),style:{background:`linear-gradient(${s} 50%, ${o} 50%)`},onClick:i?void 0:c})},q=({data:s,firstIdx:o,secondIdx:t,bigPointsIdx:r})=>{const{firstCrossed:n,secondCrossed:i,crossed:a}=B(({crossed:_,crossedBigPoints:d})=>({crossed:d[r],firstCrossed:_[o],secondCrossed:_[t]})),c=b.useCallback(_=>u.onCrossBigPoints(r,_),[r]),x=a.lastIndexOf(!0);return e.jsx(e.Fragment,{children:a.map((_,d)=>e.jsx(ns,{firstColor:s[o][d].color,secondColor:s[t][d].color,crossed:_,onClick:c,fieldIdx:d,disabled:x>=d||!n[d]&&!i[d],isLastItem:d===a.length-1},d))})},is=({field:{value:s,color:o},crossed:t,onClick:r,fieldIdx:n,disabled:i,closed:a})=>{const c=b.useCallback(()=>r(n),[r,n]);return e.jsx("div",{className:l.classNames("quixx__grid__field",t&&"quixx__grid__field--crossed",!t&&a&&"quixx__grid__field--closed",!t&&(a||i)&&"quixx__grid__field--disabled"),style:{backgroundColor:o},onClick:i||a?void 0:c,children:s===-1?e.jsx(L.Unlock,{}):s})},as=({row:s,rowIdx:o})=>{const{rowCrossed:t,rowClosed:r}=B(({crossed:c,closed:x})=>({rowCrossed:c[o],rowClosed:x[o]})),n=b.useCallback(c=>u.onCross(o,c),[o]),i=t.lastIndexOf(!0),a=t.filter(Boolean).length>=5;return e.jsx(e.Fragment,{children:s.map((c,x)=>e.jsx(is,{field:c,crossed:t[x],onClick:n,fieldIdx:x,disabled:i>=x||!a&&t.length-2===x,closed:r},c.value))})},cs=4,ls=(s,o)=>{const t=s.map((r,n)=>e.jsx(as,{row:r,rowIdx:n},n));return o&&(t.splice(1,0,e.jsx(q,{data:s,firstIdx:0,secondIdx:1,bigPointsIdx:0},"foo")),t.splice(4,0,e.jsx(q,{data:s,firstIdx:2,secondIdx:3,bigPointsIdx:1},"bar"))),t},ds=({data:s,withBigPoints:o=!1})=>{const{sum:t,badThrows:r}=B(({badThrows:n,crossed:i,crossedBigPoints:a})=>({badThrows:n,sum:u.sum(i,a,n)}));return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"quixx__grid",children:ls(s,o)}),e.jsxs("div",{className:"quixx__info",children:[e.jsxs("div",{className:"quixx__info__bad-throws",children:[e.jsx("div",{children:y("QUIXX.badThrows")}),l.array(cs).map((n,i)=>e.jsx("span",{onClick:r===i?u.onBadThrow:void 0,children:r>i?"âœ˜":""},i))]}),e.jsxs("div",{className:"quixx__info__sum",children:[e.jsx("div",{children:y("QUIXX.points")}),e.jsx("span",{children:t})]})]})]})},us=()=>e.jsxs(R,{children:[e.jsx(T,{onClick:u.undo}),e.jsx(H,{onClick:u.restart})]}),ps=()=>{const s=B(({option:t})=>t),o=b.useMemo(()=>s&&D[s],[s]);return o?e.jsx(A,{fix:u.restart,children:e.jsxs("div",{className:"quixx",children:[e.jsx("div",{className:"quixx__inner",children:e.jsx(ds,{data:o.value,withBigPoints:o.withBigPoints})}),e.jsx(us,{})]})}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{}),e.jsx(R,{children:e.jsx(T,{onClick:u.undo})})]})};export{ps as default};
